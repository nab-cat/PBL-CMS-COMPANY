<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use BezhanSalleh\FilamentShield\Support\Utils;
use Spatie\Permission\PermissionRegistrar;

class ShieldSeeder extends Seeder
{
    public function run(): void
    {
        app()[PermissionRegistrar::class]->forgetCachedPermissions();

        $rolesWithPermissions = '[{"name":"Content Management","guard_name":"web","permissions":["view_artikel","view_any_artikel","create_artikel","update_artikel","restore_artikel","restore_any_artikel","replicate_artikel","reorder_artikel","delete_artikel","delete_any_artikel","view_event","view_any_event","create_event","update_event","restore_event","restore_any_event","replicate_event","reorder_event","delete_event","delete_any_event","view_galeri","view_any_galeri","create_galeri","update_galeri","restore_galeri","restore_any_galeri","replicate_galeri","reorder_galeri","delete_galeri","delete_any_galeri","view_konten::slider","view_any_konten::slider","update_konten::slider","restore_konten::slider","restore_any_konten::slider","replicate_konten::slider","reorder_konten::slider","view_media::sosial","view_any_media::sosial","create_media::sosial","update_media::sosial","restore_media::sosial","restore_any_media::sosial","replicate_media::sosial","reorder_media::sosial","delete_media::sosial","delete_any_media::sosial","view_produk","view_any_produk","create_produk","update_produk","restore_produk","restore_any_produk","replicate_produk","reorder_produk","delete_produk","delete_any_produk","view_unduhan","view_any_unduhan","create_unduhan","update_unduhan","restore_unduhan","restore_any_unduhan","replicate_unduhan","reorder_unduhan","delete_unduhan","delete_any_unduhan","view_case::study","view_any_case::study","create_case::study","update_case::study","restore_case::study","restore_any_case::study","replicate_case::study","reorder_case::study","delete_case::study","delete_any_case::study","widget_ContentCountsChart","widget_DocumentDownloadsChart","widget_ContentTrendsChart","widget_TopArticlesByViews","widget_TopDownloads","widget_UpcomingEventsChart","widget_GaleriDownloadsChart","widget_ProductsByStatusChart","widget_TopProducts","widget_UnduhanStatusChart","widget_GaleriStatusChart","widget_CaseStudyStatusChart","widget_TrendArticlesChart","widget_TopEventsStatsWidget","widget_EventTrendsChart","widget_EventStatusChart","widget_TopGaleriesStatsWidget","widget_GaleriTrendsChart","view_kategori::artikel","view_any_kategori::artikel","create_kategori::artikel","update_kategori::artikel","restore_kategori::artikel","restore_any_kategori::artikel","replicate_kategori::artikel","reorder_kategori::artikel","delete_kategori::artikel","delete_any_kategori::artikel","force_delete_kategori::artikel","force_delete_any_kategori::artikel","view_kategori::galeri","view_any_kategori::galeri","create_kategori::galeri","update_kategori::galeri","restore_kategori::galeri","restore_any_kategori::galeri","replicate_kategori::galeri","reorder_kategori::galeri","delete_kategori::galeri","delete_any_kategori::galeri","force_delete_kategori::galeri","force_delete_any_kategori::galeri","view_kategori::produk","view_any_kategori::produk","create_kategori::produk","update_kategori::produk","restore_kategori::produk","restore_any_kategori::produk","replicate_kategori::produk","reorder_kategori::produk","delete_kategori::produk","delete_any_kategori::produk","force_delete_kategori::produk","force_delete_any_kategori::produk","view_kategori::unduhan","view_any_kategori::unduhan","create_kategori::unduhan","update_kategori::unduhan","restore_kategori::unduhan","restore_any_kategori::unduhan","replicate_kategori::unduhan","reorder_kategori::unduhan","delete_kategori::unduhan","delete_any_kategori::unduhan","force_delete_kategori::unduhan","force_delete_any_kategori::unduhan","page_ArtikelsCluster","page_GaleriCluster","page_ProdukCluster","page_UnduhanCluster"]},{"name":"Customer Service","guard_name":"web","permissions":["view_feedback","view_any_feedback","update_feedback","restore_feedback","restore_any_feedback","replicate_feedback","reorder_feedback","delete_feedback","delete_any_feedback","view_lamaran","view_any_lamaran","update_lamaran","restore_lamaran","restore_any_lamaran","replicate_lamaran","reorder_lamaran","delete_lamaran","delete_any_lamaran","view_lowongan","view_any_lowongan","create_lowongan","update_lowongan","restore_lowongan","restore_any_lowongan","replicate_lowongan","reorder_lowongan","view_testimoni::artikel","view_any_testimoni::artikel","create_testimoni::artikel","update_testimoni::artikel","restore_testimoni::artikel","restore_any_testimoni::artikel","replicate_testimoni::artikel","reorder_testimoni::artikel","delete_testimoni::artikel","delete_any_testimoni::artikel","force_delete_testimoni::artikel","force_delete_any_testimoni::artikel","view_testimoni::event","view_any_testimoni::event","create_testimoni::event","update_testimoni::event","restore_testimoni::event","restore_any_testimoni::event","replicate_testimoni::event","reorder_testimoni::event","delete_testimoni::event","delete_any_testimoni::event","force_delete_testimoni::event","force_delete_any_testimoni::event","view_testimoni::lowongan","view_any_testimoni::lowongan","create_testimoni::lowongan","update_testimoni::lowongan","restore_testimoni::lowongan","restore_any_testimoni::lowongan","replicate_testimoni::lowongan","reorder_testimoni::lowongan","delete_testimoni::lowongan","delete_any_testimoni::lowongan","force_delete_testimoni::lowongan","force_delete_any_testimoni::lowongan","view_testimoni::produk","view_any_testimoni::produk","create_testimoni::produk","update_testimoni::produk","restore_testimoni::produk","restore_any_testimoni::produk","replicate_testimoni::produk","reorder_testimoni::produk","delete_testimoni::produk","delete_any_testimoni::produk","force_delete_testimoni::produk","force_delete_any_testimoni::produk","view_testimoni::slider","view_any_testimoni::slider","create_testimoni::slider","update_testimoni::slider","restore_testimoni::slider","restore_any_testimoni::slider","replicate_testimoni::slider","reorder_testimoni::slider","delete_testimoni::slider","delete_any_testimoni::slider","force_delete_testimoni::slider","force_delete_any_testimoni::slider","page_ManageTestimoni","widget_FeedbackStatsCard","widget_FeedbackTrendChart","widget_LamaranStatsCard","widget_LamaranTrendChart","widget_LowonganStatsCard"]},{"name":"super_admin","guard_name":"web","permissions":["view_artikel","view_any_artikel","create_artikel","update_artikel","restore_artikel","restore_any_artikel","replicate_artikel","reorder_artikel","delete_artikel","delete_any_artikel","force_delete_artikel","force_delete_any_artikel","view_case::study","view_any_case::study","create_case::study","update_case::study","restore_case::study","restore_any_case::study","replicate_case::study","reorder_case::study","delete_case::study","delete_any_case::study","force_delete_case::study","force_delete_any_case::study","view_event","view_any_event","create_event","update_event","restore_event","restore_any_event","replicate_event","reorder_event","delete_event","delete_any_event","force_delete_event","force_delete_any_event","view_feature::toggle","view_any_feature::toggle","create_feature::toggle","update_feature::toggle","restore_feature::toggle","restore_any_feature::toggle","replicate_feature::toggle","reorder_feature::toggle","delete_feature::toggle","delete_any_feature::toggle","force_delete_feature::toggle","force_delete_any_feature::toggle","view_feedback","view_any_feedback","create_feedback","update_feedback","restore_feedback","restore_any_feedback","replicate_feedback","reorder_feedback","delete_feedback","delete_any_feedback","force_delete_feedback","force_delete_any_feedback","view_galeri","view_any_galeri","create_galeri","update_galeri","restore_galeri","restore_any_galeri","replicate_galeri","reorder_galeri","delete_galeri","delete_any_galeri","force_delete_galeri","force_delete_any_galeri","view_kategori::artikel","view_any_kategori::artikel","create_kategori::artikel","update_kategori::artikel","restore_kategori::artikel","restore_any_kategori::artikel","replicate_kategori::artikel","reorder_kategori::artikel","delete_kategori::artikel","delete_any_kategori::artikel","force_delete_kategori::artikel","force_delete_any_kategori::artikel","view_kategori::galeri","view_any_kategori::galeri","create_kategori::galeri","update_kategori::galeri","restore_kategori::galeri","restore_any_kategori::galeri","replicate_kategori::galeri","reorder_kategori::galeri","delete_kategori::galeri","delete_any_kategori::galeri","force_delete_kategori::galeri","force_delete_any_kategori::galeri","view_kategori::produk","view_any_kategori::produk","create_kategori::produk","update_kategori::produk","restore_kategori::produk","restore_any_kategori::produk","replicate_kategori::produk","reorder_kategori::produk","delete_kategori::produk","delete_any_kategori::produk","force_delete_kategori::produk","force_delete_any_kategori::produk","view_kategori::unduhan","view_any_kategori::unduhan","create_kategori::unduhan","update_kategori::unduhan","restore_kategori::unduhan","restore_any_kategori::unduhan","replicate_kategori::unduhan","reorder_kategori::unduhan","delete_kategori::unduhan","delete_any_kategori::unduhan","force_delete_kategori::unduhan","force_delete_any_kategori::unduhan","view_konten::slider","view_any_konten::slider","create_konten::slider","update_konten::slider","restore_konten::slider","restore_any_konten::slider","replicate_konten::slider","reorder_konten::slider","delete_konten::slider","delete_any_konten::slider","force_delete_konten::slider","force_delete_any_konten::slider","view_lamaran","view_any_lamaran","create_lamaran","update_lamaran","restore_lamaran","restore_any_lamaran","replicate_lamaran","reorder_lamaran","delete_lamaran","delete_any_lamaran","force_delete_lamaran","force_delete_any_lamaran","view_lowongan","view_any_lowongan","create_lowongan","update_lowongan","restore_lowongan","restore_any_lowongan","replicate_lowongan","reorder_lowongan","delete_lowongan","delete_any_lowongan","force_delete_lowongan","force_delete_any_lowongan","view_media::sosial","view_any_media::sosial","create_media::sosial","update_media::sosial","restore_media::sosial","restore_any_media::sosial","replicate_media::sosial","reorder_media::sosial","delete_media::sosial","delete_any_media::sosial","force_delete_media::sosial","force_delete_any_media::sosial","view_mitra","view_any_mitra","create_mitra","update_mitra","restore_mitra","restore_any_mitra","replicate_mitra","reorder_mitra","delete_mitra","delete_any_mitra","force_delete_mitra","force_delete_any_mitra","view_produk","view_any_produk","create_produk","update_produk","restore_produk","restore_any_produk","replicate_produk","reorder_produk","delete_produk","delete_any_produk","force_delete_produk","force_delete_any_produk","view_profil::perusahaan","view_any_profil::perusahaan","create_profil::perusahaan","update_profil::perusahaan","restore_profil::perusahaan","restore_any_profil::perusahaan","replicate_profil::perusahaan","reorder_profil::perusahaan","delete_profil::perusahaan","delete_any_profil::perusahaan","force_delete_profil::perusahaan","force_delete_any_profil::perusahaan","view_role","view_any_role","create_role","update_role","delete_role","delete_any_role","view_struktur::organisasi","view_any_struktur::organisasi","create_struktur::organisasi","update_struktur::organisasi","restore_struktur::organisasi","restore_any_struktur::organisasi","replicate_struktur::organisasi","reorder_struktur::organisasi","delete_struktur::organisasi","delete_any_struktur::organisasi","force_delete_struktur::organisasi","force_delete_any_struktur::organisasi","view_testimoni::artikel","view_any_testimoni::artikel","create_testimoni::artikel","update_testimoni::artikel","restore_testimoni::artikel","restore_any_testimoni::artikel","replicate_testimoni::artikel","reorder_testimoni::artikel","delete_testimoni::artikel","delete_any_testimoni::artikel","force_delete_testimoni::artikel","force_delete_any_testimoni::artikel","view_testimoni::event","view_any_testimoni::event","create_testimoni::event","update_testimoni::event","restore_testimoni::event","restore_any_testimoni::event","replicate_testimoni::event","reorder_testimoni::event","delete_testimoni::event","delete_any_testimoni::event","force_delete_testimoni::event","force_delete_any_testimoni::event","view_testimoni::lowongan","view_any_testimoni::lowongan","create_testimoni::lowongan","update_testimoni::lowongan","restore_testimoni::lowongan","restore_any_testimoni::lowongan","replicate_testimoni::lowongan","reorder_testimoni::lowongan","delete_testimoni::lowongan","delete_any_testimoni::lowongan","force_delete_testimoni::lowongan","force_delete_any_testimoni::lowongan","view_testimoni::produk","view_any_testimoni::produk","create_testimoni::produk","update_testimoni::produk","restore_testimoni::produk","restore_any_testimoni::produk","replicate_testimoni::produk","reorder_testimoni::produk","delete_testimoni::produk","delete_any_testimoni::produk","force_delete_testimoni::produk","force_delete_any_testimoni::produk","view_testimoni::slider","view_any_testimoni::slider","create_testimoni::slider","update_testimoni::slider","restore_testimoni::slider","restore_any_testimoni::slider","replicate_testimoni::slider","reorder_testimoni::slider","delete_testimoni::slider","delete_any_testimoni::slider","force_delete_testimoni::slider","force_delete_any_testimoni::slider","view_unduhan","view_any_unduhan","create_unduhan","update_unduhan","restore_unduhan","restore_any_unduhan","replicate_unduhan","reorder_unduhan","delete_unduhan","delete_any_unduhan","force_delete_unduhan","force_delete_any_unduhan","view_user","view_any_user","create_user","update_user","restore_user","restore_any_user","replicate_user","reorder_user","delete_user","delete_any_user","force_delete_user","force_delete_any_user","page_ViewEnv","page_ArtikelsCluster","page_GaleriCluster","page_ProdukCluster","page_UnduhanCluster","page_ManageTestimoni","widget_TotalUsersWidget","widget_UsersByRoleWidget","widget_FeatureTooglesWidget","widget_StorageUsageChart","widget_RemainingStorageWidget","widget_StorageUsageByFeatureChart"]},{"name":"Director","guard_name":"web","permissions":["view_artikel","view_any_artikel","view_event","view_any_event","view_galeri","view_any_galeri","view_konten::slider","view_any_konten::slider","view_media::sosial","view_any_media::sosial","view_produk","view_any_produk","view_unduhan","view_any_unduhan","view_case::study","view_any_case::study","view_feedback","view_any_feedback","view_lamaran","view_any_lamaran","view_lowongan","view_any_lowongan","view_testimoni","view_any_testimoni","view_mitra","view_any_mitra","create_mitra","update_mitra","restore_mitra","restore_any_mitra","replicate_mitra","reorder_mitra","delete_mitra","delete_any_mitra","view_profil::perusahaan","view_any_profil::perusahaan","update_profil::perusahaan","restore_profil::perusahaan","restore_any_profil::perusahaan","replicate_profil::perusahaan","reorder_profil::perusahaan","view_role","view_any_role","view_struktur::organisasi","view_any_struktur::organisasi","create_struktur::organisasi","update_struktur::organisasi","restore_struktur::organisasi","restore_any_struktur::organisasi","replicate_struktur::organisasi","reorder_struktur::organisasi","delete_struktur::organisasi","delete_any_struktur::organisasi","view_user","view_any_user","view_feature::toggle","view_any_feature::toggle","widget_CustomerServiceActivityTrend","widget_ContentGrowthTrend","widget_ContentGrowthPerFiturTrend","widget_CustomerServiceStats","widget_CustomerServiceGrowth","widget_ContentManagerStats","view_kategori::artikel","view_any_kategori::artikel","view_kategori::galeri","view_any_kategori::galeri","view_kategori::produk","view_any_kategori::produk","view_kategori::unduhan","view_any_kategori::unduhan"]}]';
        $directPermissions = '{"170":{"name":"update_testimoni","guard_name":"web"},"171":{"name":"restore_testimoni","guard_name":"web"},"172":{"name":"restore_any_testimoni","guard_name":"web"},"173":{"name":"replicate_testimoni","guard_name":"web"},"174":{"name":"reorder_testimoni","guard_name":"web"},"266":{"name":"create_testimoni","guard_name":"web"},"267":{"name":"delete_testimoni","guard_name":"web"},"268":{"name":"delete_any_testimoni","guard_name":"web"},"269":{"name":"force_delete_testimoni","guard_name":"web"},"270":{"name":"force_delete_any_testimoni","guard_name":"web"},"298":{"name":"widget_TopArticlesChart","guard_name":"web"},"299":{"name":"widget_TopCaseStudiesChart","guard_name":"web"},"300":{"name":"widget_TopInteractionsArticles","guard_name":"web"},"301":{"name":"widget_ContentManagerMultiWidget","guard_name":"web"}}';

        static::makeRolesWithPermissions($rolesWithPermissions);
        static::makeDirectPermissions($directPermissions);

        $this->command->info('Shield Seeding Completed.');
    }

    protected static function makeRolesWithPermissions(string $rolesWithPermissions): void
    {
        if (! blank($rolePlusPermissions = json_decode($rolesWithPermissions, true))) {
            /** @var Model $roleModel */
            $roleModel = Utils::getRoleModel();
            /** @var Model $permissionModel */
            $permissionModel = Utils::getPermissionModel();

            foreach ($rolePlusPermissions as $rolePlusPermission) {
                $role = $roleModel::firstOrCreate([
                    'name' => $rolePlusPermission['name'],
                    'guard_name' => $rolePlusPermission['guard_name'],
                ]);

                if (! blank($rolePlusPermission['permissions'])) {
                    $permissionModels = collect($rolePlusPermission['permissions'])
                        ->map(fn ($permission) => $permissionModel::firstOrCreate([
                            'name' => $permission,
                            'guard_name' => $rolePlusPermission['guard_name'],
                        ]))
                        ->all();

                    $role->syncPermissions($permissionModels);
                }
            }
        }
    }

    public static function makeDirectPermissions(string $directPermissions): void
    {
        if (! blank($permissions = json_decode($directPermissions, true))) {
            /** @var Model $permissionModel */
            $permissionModel = Utils::getPermissionModel();

            foreach ($permissions as $permission) {
                if ($permissionModel::whereName($permission)->doesntExist()) {
                    $permissionModel::create([
                        'name' => $permission['name'],
                        'guard_name' => $permission['guard_name'],
                    ]);
                }
            }
        }
    }
}
